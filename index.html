<html ng-app="myApp">
	<head>
		<title>Red Lion {REDEFINE}</title>
		<link rel="stylesheet" href="css/style.css?v=1.0">
	</head>
	<body ng-controller="CardTestController">
		<header>
			<a href="#" id="launchAbout">culture<br>careers<br>contact</a>
			<form>
				<input type="text" name="searchterm" id="searchTerm">
				<input type="text" id="cachedTerm">
				<input type="submit" style="display:none;" name="submit">
				<img id="searchCancel" src="img/close-btn-grey.png"/>
			</form>
			<img src="img/rl.gif" />
		</header>
		<div id="controls"></div>
		<div id="blackout">
			<div id="overlay">
				
			</div>
		</div>
		<div id="canvas"></div>
		<script id="vs" type="x-shader/x-vertex">

			varying vec2 vUv;

			void main() {

				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			}

		</script>
		<script id="fs" type="x-shader/x-fragment">

			uniform sampler2D map;

			uniform vec3 fogColor;
			uniform float fogNear;
			uniform float fogFar;

			varying vec2 vUv;

			void main() {

				float depth = gl_FragCoord.z / gl_FragCoord.w;
				float fogFactor = smoothstep( fogNear, fogFar, depth );

				gl_FragColor = texture2D( map, vUv );
				gl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );
				gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

			}

		</script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js"></script>
		<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
		<script src="js/min/pinch.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/1.3.0/math.min.js"></script>
		<script src="js/tween.min.js"></script>
		<script src="js/fuse.min.js"></script>
		<script src="js/objects.js"></script>
		<script src="js/options.js"></script>
		<script src="js/app.js"></script>
		<script src="js/controls.js"></script>
		<script src="js/main.js"></script>
		<script type="text/javascript">
			$('#searchCancel').on('click', function(e) {
				SpawnCity("home");
				$('#searchCancel').animate({'opacity':'0'},400,function(){$(this).css('display','none')});
			});
			$('#searchTerm').on('keydown', function(e) {
				var val = $(this).val();
				if ($(this).val().length > 32) {
					var s = val;
					s = s.substring(0, s.length-1);
					$(this).val(s);
				}
				if (e.keyCode == 13 && $(this).val().length != 0) {	//enter
					var result = SpawnCity(val);
					if (result && val != homeKeyword) {
						$('#searchCancel').css('display','block').animate({'opacity':'1'},400);
					}
					$('#cachedTerm').val('');
					$(this).val('');
					return;
				} else if (e.keyCode == 9 || e.keyCode == 39) {	//tab, right arrow
					e.preventDefault();
					var t = $('#cachedTerm').val();
					$(this).val(t);
				} else if (e.keyCode == 8) {	//backspace
					$('#cachedTerm').val('');
				}
			});
			$('#searchTerm').on('input', function(e) {
				var term = $(this).val();
				var search = dataController.GetIdsWithTag(term);
				if (search.length == 0) {
					$('#cachedTerm').val('');
					return;
				} else {
					if (typeof search[0] === 'undefined') {
						$('#cachedTerm').val('');
						return;
					}
				}
				for (var a in search) {
					var tags = search[a].split(', ');
					for (var i in tags) {
						if (tags[i].substring(0,term.length) == term) {
							$('#cachedTerm').val(tags[i]);
							return;
						}
					}
				}
				$('#cachedTerm').val('');
			});
		</script>
		<script src="//use.typekit.net/ngi3tcl.js"></script>
		<script>try{Typekit.load();}catch(e){}</script>
	</body>
</html>