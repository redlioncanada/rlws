var glCards=[],boxid=0,loadInterval,app=angular.module("redLion",["ngRoute"]);app.config(["$routeProvider",function(e){e.when("/grid",{template:" ",controller:"GridControler"}).when("/work/:campaignID/:subSection",{templateUrl:"templates/work.html",controller:"WorkCtrl"}).when("/disciplines/:disciplineID",{templateUrl:"templates/discipline.html",controller:"DisciplineCtrl"}).when("/news/:newsID",{templateUrl:"templates/news.html",controller:"NewsCtrl"}).otherwise({redirectTo:"/grid"})}]),app.controller("CardTestController",function(e,t,n){e.cards=t.get(),init3D()}),app.factory("Cards",function(e){var t=[];return{get:function(){return 0===t.length&&e.get("http://redlioncanada.com/api/content/").success(function(e){for(var n=0,i=e.length;i>n;n++)t.push(e[n])}).error(function(e){alert("ERROR: "+e)}),glCards=t,t}}}),app.controller("GridControler",function(e){}),app.controller("NewsCtrl",["$scope","$routeParams","$timeout","$sce",function(e,t,n,i){e.dslug=t.newsID,e.outputHTML=function(e){return i.trustAsHtml(e)},0!==boxid?(e.newsitem=dataController.GetBySlug(e.dslug),e.newsitem.date_launched=Date.parse(e.newsitem.date_launched),overlayFadeIn(),closeButtonStart()):n(function(){e.newsitem=dataController.GetBySlug(e.dslug),e.newsitem.date_launched=Date.parse(e.newsitem.date_launched),overlayFadeIn(),closeButtonStart()},1e3)}]),app.controller("WorkCtrl",["$scope","$routeParams","$sce","$timeout",function(e,t,n,i){e.campaignID=t.campaignID,e.startSection=t.subSection,e.outputHTML=function(e){return n.trustAsHtml(e)},0!==boxid?getWorkData(e,n,i):i(function(){dataController.GetBySlug(e.campaignID)!==!1&&(getWorkData(e,n,i),clearInterval(loadInterval))},1e3)}]);var audioPlayerStart=function(){var e=document.getElementsByClassName("audio_file");$(".play-pause-btn").click(function(){var e=$(this).siblings("audio").get(0);e.paused?(e.play(),$(this).attr("src","img/pause-btn.gif")):(e.pause(),$(this).attr("src","img/play-btn.gif"))}),$(".rwd-btn").click(function(){var e=$(this).siblings("audio").get(0);e.currentTime=0}),$(".ffwd-btn").click(function(){var e=$(this).siblings("audio").get(0);e.currentTime+=5});for(var t=0;t<e.length;t++){var n=e[t];setTimeout(audioLoadTimeout,200,n),n.addEventListener("timeupdate",function(e){var t=$(n).siblings("div.meter")[0],i=$(t).children("span")[0],o=n.currentTime/n.duration*100;$(i).css("width",o+"%");var a=$(n).siblings(".time-readout")[0],r=$(a).children(".audioCurrent")[0];$(r).text(getMinSec(n.currentTime))},!1),n.addEventListener("ended",function(e){n.pause()},!1)}},audioLoadTimeout=function(e){var t=$(e).siblings(".time-readout")[0],n=$(t).children(".audioTotal")[0];$(n).text(getMinSec(e.duration))},getMinSec=function(e){var t=Math.floor(e/60),n=parseInt(e-60*t);return 10>n&&(n="0"+n),t+":"+n},getWorkData=function(e,t,n){e.work=dataController.GetBySlug(e.campaignID),e.work.date_launched=Date.parse(e.work.date_launched);for(var i=e.work.video_comsep,o=0;o<i.length;o++)""!==e.work.video_comsep[o]&&"string"==typeof e.work.video_comsep[o]&&(e.work.video_comsep[o]=t.trustAsResourceUrl(e.work.video_comsep[o]));var a={dots:!0,infinite:!0,speed:500,slidesToShow:1,adaptiveHeight:!0};""!==e.work.print_comsep[0]&&n(function(){$(".printwork").slick(a)},1e3),""!==e.work.digital_comsep[0]&&n(function(){$(".digitalwork").slick(a)},1e3),audioPlayerStart(),overlayFadeIn(),closeButtonStart()};app.controller("DisciplineCtrl",["$scope","$routeParams","$timeout",function(e,t,n){e.dslug=t.disciplineID,closeButtonStart(),0!==boxid?(e.disciplines=dataController.GetByType("disciplines"),overlayFadeIn()):n(function(){e.disciplines=dataController.GetByType("disciplines"),overlayFadeIn()},1e3),n(function(){$(".dcontainer."+e.dslug+" p").slideDown(),$(".dcontainer."+e.dslug+" h1").addClass("selected"),$(".dcontainer."+e.dslug+" h1 span").html("-"),$(".dcontainer h1").click(function(){$(this).hasClass("selected")||($(".dcontainer p").slideUp(),$(".dcontainer h1").removeClass("selected"),$(".dcontainer h1 span").html("+"),$(this).addClass("selected"),$(this).children("span").html("-"),$(this).siblings("p").slideDown())})},1200)}]);var overlayFadeIn=function(e,t){"undefined"==typeof e&&(e=1e3),"undefined"==typeof t&&(t="easeOutCubic"),$("#blackout").css({display:"block"}),$("#blackout").velocity({opacity:1,"padding-top":0},{duration:e,easing:t})},closeButtonStart=function(e,t){"undefined"==typeof e&&(e=1e3),"undefined"==typeof t&&(t="easeOutCubic"),$(".close").on("click",function(n){n.preventDefault(),$("#blackout").velocity({opacity:0,"padding-top":50},{duration:e,easing:t,complete:function(){$(this).css({display:"none"}),window.location.href="#/grid"}})})};