function boxClicked(e){$("#blackout").css({display:"block"}).animate({opacity:1},500),overlay=!0,$("#overlay").html("box clicked: "+e.name+"<br>Content title: "+glCards[parseInt(e.name)].title+"<br>Description: "+glCards[parseInt(e.name)].description+'<br>Image: <img src="'+glCards[parseInt(e.name)].img+'">'),$("#blackout").on("click touchend",function(e){$(this).animate({opacity:0},500,function(){$("#blackout").css({display:"none"}),overlay=!1}),$(this).unbind("click")})}function fingerMouseDown(e){if(e.preventDefault(),isMobile)if(2==e.touches.length)console.log(e.touches);else{var a=e.touches[0];oldTouchX=a.pageX,oldTouchY=a.pageY}else oldTouchX=e.clientX,oldTouchY=e.clientY;mTouchDown=!0,canvas.addEventListener("mousemove",fingerMouseDrag)}function fingerMouseDrag(e){e.preventDefault();var a,n,t,o;if(isMobile){var i=e.touches[0];a=i.pageX-oldTouchX,t=i.pageX,n=i.pageY-oldTouchY,o=i.pageY}else mTouchDown&&(a=e.clientX-oldTouchX,t=e.clientX,n=e.clientY-oldTouchY,o=e.clientY);xMove!=a&&(xMove=a,oldTouchX=t),yMove!=n&&(yMove=n,oldTouchY=o),(Math.abs(camera.position.y)<=Math.abs(originY-camY2Extents)&&0>n||Math.abs(camera.position.y)>=Math.abs(originY+camY1Extents)&&n>0)&&animations.CameraMove(void 0,n/250),(Math.abs(camera.position.x)<=Math.abs(originX-camX1Extents)&&a>0||Math.abs(camera.position.x)>=Math.abs(originX+camX2Extents)&&0>a)&&animations.CameraMove(-a/250,void 0)}function fingerMouseUp(e){e.preventDefault(),canvas.removeEventListener("mousemove",fingerMouseDrag);var a,n,t;if(xMove<1&&xMove>-1&&yMove<1&&yMove>-1&&!pinched){isMobile?(a=e.pageX/window.innerWidth*2-1,n=2*-(e.pageY/window.innerHeight)+1,t=new THREE.Vector3(a,n,.5)):(a=e.clientX/window.innerWidth*2-1,n=2*-(e.clientY/window.innerHeight)+1,t=new THREE.Vector3(a,n,.5));var o=new THREE.Raycaster;t.unproject(camera),o.set(camera.position,t.sub(camera.position).normalize());var i=o.intersectObjects(objects);i.length>0&&boxClicked(i[0].object)}xMove=0,yMove=0,mUP=!1,mDOWN=!1,mRIGHT=!1,mDOWN=!1,mTouchDown=!1,oldScale=0,pinched=!1}function zoomHandler(e){var a=Math.max(-.1,Math.min(.1,e.wheelDelta||-e.detail));(camera.position.z>camMinHeight&&a>0||camera.position.z<camMaxHeight&&0>a)&&(camera.position.z-=a)}function resetPinches(){$(document).on("pinchstart",function(e){oldScale=0,pinched=!0}),$(document).on("pinchmove",function(e){pinched=!0;var a=e.scale-oldScale;oldScale=e.scale,camera.position.z<camMaxHeight&&0>a?camera.position.z+=.1:camera.position.z>camMinHeight&&a>0&&(camera.position.z-=.1)}),$(document).on("pinchend",function(e){oldScale=0,pinched=!1,$(document).off("pinchstart pinchmove pinchend"),resetPinches()})}function setupEventListeners(){var e=document.getElementsByTagName("canvas");canvas=e[0],canvas.addEventListener("touchstart",fingerMouseDown),canvas.addEventListener("mousedown",fingerMouseDown),canvas.addEventListener("touchend",fingerMouseUp),canvas.addEventListener("mouseup",fingerMouseUp),canvas.addEventListener("touchmove",fingerMouseDrag),canvas.addEventListener("mousewheel",zoomHandler)}$(document).keydown(function(e){38==e.which&&(e.preventDefault(),console.log("camy:"+Math.abs(camera.position.y)+",constrain:"+Math.abs(originY+camY1Extents)),mUP=!0),40==e.which&&(e.preventDefault(),console.log("camy:"+Math.abs(camera.position.y)+",constrain:"+Math.abs(originY-camY2Extents)),mDOWN=!0),37==e.which&&(e.preventDefault(),console.log("camx:"+Math.abs(camera.position.x)+",constrain:"+Math.abs(originX-camX1Extents)),mLEFT=!0),39==e.which&&(e.preventDefault(),console.log("camx:"+Math.abs(camera.position.x)+",constrain:"+Math.abs(originX+camX2Extents)),mRIGHT=!0),34==e.which&&(e.preventDefault(),mGOIN=!0),33==e.which&&(e.preventDefault(),mGOOUT=!0),36==e.which&&(e.preventDefault(),mROTUP=!0),35==e.which&&(e.preventDefault(),mROTDOWN=!0)}),$(document).keyup(function(e){38==e.which&&(e.preventDefault(),mUP=!1),40==e.which&&(e.preventDefault(),mDOWN=!1),37==e.which&&(e.preventDefault(),mLEFT=!1),39==e.which&&(e.preventDefault(),mRIGHT=!1),34==e.which&&(e.preventDefault(),mGOIN=!1),33==e.which&&(e.preventDefault(),mGOOUT=!1),36==e.which&&(e.preventDefault(),mROTUP=!1),35==e.which&&(e.preventDefault(),mROTDOWN=!1)}),resetPinches();var ay=0,oldaz=null,az=0,arAlpha=0,arBeta=0,arGamma=0,camTween=null,camTweening=!1,camTiltTweening=!1,speed=3,devMoveHandler=function(e){rR=e.rotationRate,null!==rR&&(arAlpha=rR.alpha,isiOS||(arAlpha=40*arAlpha),arBeta=rR.beta,isiOS||(arBeta=40*arBeta)),az=Math.abs(1*e.accelerationIncludingGravity.z),null===oldaz&&(oldaz=az);var a;a=Math.abs(arBeta)>10?-arBeta/250:0;var n;if(n=Math.abs(arAlpha)>10?arAlpha/150:0,0!==n||0!==a){var t=camera.position.x,o=camera.position.y,i=t+a,c=o+n;camera.position.x+=(i-t)/speed,camera.position.y+=(c-o)/speed}if(az>oldaz||oldaz>az){var r=.09*az,s=camera.rotation.x;camera.rotation.x+=(r-s)/speed}oldaz=az};window.DeviceMotionEvent&&window.addEventListener("devicemotion",devMoveHandler,!1);