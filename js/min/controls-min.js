function boxClicked(a){$("#blackout").css({display:"block"}).animate({opacity:1},500),overlay=!0,$("#overlay").html("box clicked: "+a.name+"<br>Content title: "+glCards[parseInt(a.name)].title+"<br>Description: "+glCards[parseInt(a.name)].description+'<br>Image: <img src="'+glCards[parseInt(a.name)].img+'">'),$("#blackout").on("click touchend",function(a){$(this).animate({opacity:0},500,function(){$("#blackout").css({display:"none"}),overlay=!1}),$(this).unbind("click")})}function fingerMouseDown(a){if(a.preventDefault(),isMobile)if(2==a.touches.length)console.log(a.touches);else{var e=a.touches[0];oldTouchX=e.pageX,oldTouchY=e.pageY}else oldTouchX=a.clientX,oldTouchY=a.clientY;mTouchDown=!0,canvas.addEventListener("mousemove",fingerMouseDrag)}function fingerMouseDrag(a){a.preventDefault();var e,c,o,t;if(isMobile){var n=a.touches[0];e=n.pageX-oldTouchX,o=n.pageX,c=n.pageY-oldTouchY,t=n.pageY}else mTouchDown&&(e=a.clientX-oldTouchX,o=a.clientX,c=a.clientY-oldTouchY,t=a.clientY);xMove!=e&&(xMove=e,oldTouchX=o),yMove!=c&&(yMove=c,oldTouchY=t),animations.CameraMove(void 0,c/250),animations.CameraMove(-e/250,void 0)}function fingerMouseUp(a){a.preventDefault(),canvas.removeEventListener("mousemove",fingerMouseDrag);var e,c,o;if(xMove<1&&xMove>-1&&yMove<1&&yMove>-1&&!pinched){isMobile?(e=a.pageX/window.innerWidth*2-1,c=2*-(a.pageY/window.innerHeight)+1,o=new THREE.Vector3(e,c,.5)):(e=a.clientX/window.innerWidth*2-1,c=2*-(a.clientY/window.innerHeight)+1,o=new THREE.Vector3(e,c,.5));var t=new THREE.Raycaster;o.unproject(camera),t.set(camera.position,o.sub(camera.position).normalize());var n=t.intersectObjects(objects);n.length>0&&boxClicked(n[0].object)}xMove=0,yMove=0,mUP=!1,mDOWN=!1,mRIGHT=!1,mDOWN=!1,mTouchDown=!1,oldScale=0,pinched=!1}function zoomHandler(a){var e=Math.max(-.1,Math.min(.1,a.wheelDelta||-a.detail));(camera.position.z>camMinHeight&&e>0||camera.position.z<camMaxHeight&&0>e)&&(camera.position.z-=e)}function resetPinches(){$(document).on("pinchstart",function(a){oldScale=0,pinched=!0}),$(document).on("pinchmove",function(a){pinched=!0;var e=a.scale-oldScale;oldScale=a.scale,camera.position.z<camMaxHeight&&0>e?camera.position.z+=.1:camera.position.z>camMinHeight&&e>0&&(camera.position.z-=.1)}),$(document).on("pinchend",function(a){oldScale=0,pinched=!1,$(document).off("pinchstart pinchmove pinchend"),resetPinches()})}function setupEventListeners(){var a=document.getElementsByTagName("canvas");canvas=a[0],canvas.addEventListener("touchstart",fingerMouseDown),canvas.addEventListener("mousedown",fingerMouseDown),canvas.addEventListener("touchend",fingerMouseUp),canvas.addEventListener("mouseup",fingerMouseUp),canvas.addEventListener("touchmove",fingerMouseDrag),canvas.addEventListener("mousewheel",zoomHandler),canvas.addEventListener("DOMMouseScroll",zoomHandler),window.DeviceMotionEvent&&window.addEventListener("devicemotion",devMoveHandler,!1)}$(document).keydown(function(a){38==a.which&&(a.preventDefault(),console.log("camy:"+Math.abs(camera.position.y)+",constrain:"+Math.abs(originY+camY1Extents)),mUP=!0),40==a.which&&(a.preventDefault(),console.log("camy:"+Math.abs(camera.position.y)+",constrain:"+Math.abs(originY-camY2Extents)),mDOWN=!0),37==a.which&&(a.preventDefault(),console.log("camx:"+Math.abs(camera.position.x)+",constrain:"+Math.abs(originX-camX1Extents)),mLEFT=!0),39==a.which&&(a.preventDefault(),console.log("camx:"+Math.abs(camera.position.x)+",constrain:"+Math.abs(originX+camX2Extents)),mRIGHT=!0),34==a.which&&(a.preventDefault(),mGOIN=!0),33==a.which&&(a.preventDefault(),mGOOUT=!0),36==a.which&&(a.preventDefault(),mROTUP=!0),35==a.which&&(a.preventDefault(),mROTDOWN=!0)}),$(document).keyup(function(a){38==a.which&&(a.preventDefault(),mUP=!1),40==a.which&&(a.preventDefault(),mDOWN=!1),37==a.which&&(a.preventDefault(),mLEFT=!1),39==a.which&&(a.preventDefault(),mRIGHT=!1),34==a.which&&(a.preventDefault(),mGOIN=!1),33==a.which&&(a.preventDefault(),mGOOUT=!1),36==a.which&&(a.preventDefault(),mROTUP=!1),35==a.which&&(a.preventDefault(),mROTDOWN=!1)}),resetPinches();var acc_oldaz=null,acc_az=0,acc_arAlpha=0,acc_arBeta=0,acc_speed=5,acc_fromx=null,acc_tox=null,acc_fromy=null,acc_toy=null,acc_totilt=null,acc_fromtilt=null,devMoveHandler=function(a){null===acc_fromx&&(acc_fromx=camera.position.x),null===acc_tox&&(acc_tox=camera.position.x),null===acc_fromy&&(acc_fromy=camera.position.y),null===acc_toy&&(acc_toy=camera.position.y),null===acc_totilt&&(acc_totilt=camera.rotation.x),null===acc_fromtilt&&(acc_fromtilt=camera.rotation.x);var e=a.rotationRate;if(null!==e&&(acc_arAlpha=e.alpha,isiOS||(acc_arAlpha=40*acc_arAlpha),acc_arBeta=e.beta,isiOS||(acc_arBeta=40*acc_arBeta)),mTouchDown)acc_toy=acc_fromy=camera.position.y,acc_tox=acc_fromx=camera.position.x;else{if(acc_fromx=camera.position.x,Math.abs(acc_arBeta)>10){var c=-acc_arBeta/150;acc_tox=acc_fromx+c}if(camera.position.x+=(acc_tox-acc_fromx)/acc_speed,acc_fromy=camera.position.y,Math.abs(acc_arAlpha)>10){var o=acc_arAlpha/75;acc_toy=acc_fromy+o}camera.position.y+=(acc_toy-acc_fromy)/acc_speed}acc_az=Math.abs(1*a.accelerationIncludingGravity.z),null===acc_oldaz&&(acc_oldaz=acc_az),acc_fromtilt=camera.rotation.x,(acc_az>acc_oldaz+.5||acc_oldaz-.5>acc_az)&&(acc_totilt=.09*(acc_az-3)),camera.rotation.x+=(acc_totilt-acc_fromtilt)/(2*acc_speed),acc_oldaz=acc_az};