var _objects=function(){var t=this;this.dataController=function(t){this.data=[],"undefined"!=typeof t&&this.SetData(t)},this.dataController.prototype.SetData=function(t){for(var i=0;i<t.length;i++)this.data[parseInt(t[i].id)]=t[i]},this.dataController.prototype.GetByID=function(t){return this.data[t]},this.cameraController=function(t,i){this.camera=t,this.light=i,this.constraints={X1:0,Y1:0,Z1:0,X2:0,Y2:0,Z2:0,R1:0,R2:0},this.origin={X:0,Y:0}},this.cameraController.prototype.CenterOnCity=function(t,i){if("undefined"==typeof i&&(i=!1),-1==t)return console.log("Error (cameraController.CenterOnCity): Tried to Center on an invalid city"),0;var e=t.extents.X1-camXExtents,n=t.extents.Y1-camYExtents,o=t.extents.Z1-camZ1Extents,s=t.extents.X2+camXExtents,r=t.extents.Y2+camYExtents,a=t.extents.Z2+camZ2Extents;this.SetConstraints(e,n,o,camRotateMin,s,r,a,camRotateMax),i?this.Move(t.midpoint.X,t.midpoint.Y):this.Pan(t.midpoint.X,t.midpoint.Y,void 0,void 0,camPanToCityAnimationTime,!0,!1),this.SetOrigin(t.midpoint.X,t.midpoint.Y)},this.cameraController.prototype.SetConstraints=function(t,i,e,n,o,s,r,a){"undefined"!=typeof t&&(this.constraints.X1=t),"undefined"!=typeof i&&(this.constraints.Y1=i),"undefined"!=typeof e&&(this.constraints.Z1=e),"undefined"!=typeof n&&(this.constraints.R1=n),"undefined"!=typeof o&&(this.constraints.X2=o),"undefined"!=typeof s&&(this.constraints.Y2=s),"undefined"!=typeof r&&(this.constraints.Z2=r),"undefined"!=typeof a&&(this.constraints.R2=a)},this.cameraController.prototype.SetOrigin=function(t,i){"undefined"!=typeof t&&(this.origin.X=t),"undefined"!=typeof i&&(this.origin.Y=i)},this.cameraController.prototype.Pan=function(t,i,e,n,o,s,r){this.PanX(t,e,o,s,r),this.PanY(i,n,o,s,r),console.log("Pan: X:"+t+",Y:"+i)},this.cameraController.prototype.PanX=function(t,i,e,n,o){var s=this;if("undefined"==typeof e&&(e=.01),"undefined"==typeof o&&(o=!0),"undefined"==typeof n&&(n=!1),"undefined"==typeof i&&(i=this.camera.position.x),n||(t=i+t),this.HitTestX(t)||!o)var r=new TWEEN.Tween({x:i}).to({x:t},1e3*e).onUpdate(function(){s.camera.position.x=this.x,s.light.position.x=this.x}).start();console.log("PanX:"+t)},this.cameraController.prototype.PanY=function(t,i,e,n,o){var s=this;if("undefined"==typeof e&&(e=.01),"undefined"==typeof o&&(o=!0),"undefined"==typeof n&&(n=!1),"undefined"==typeof i&&(i=this.camera.position.y),n||(t=i+t),this.HitTestY(t)||!o)var r=new TWEEN.Tween({y:i}).to({y:t},1e3*e).onUpdate(function(){s.camera.position.y=this.y,s.light.position.y=this.y}).start();console.log("PanY:"+t)},this.cameraController.prototype.Zoom=function(t,i,e,n){var o=this;if("undefined"==typeof e&&(e=.01),"undefined"==typeof n&&(n=!1),"undefined"==typeof i&&(i=this.camera.position.z),n||(t=i+t),console.log("Zoom: "+t),this.HitTestZ(t))var s=new TWEEN.Tween({z:i}).to({z:t},1e3*e).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){o.camera.position.z=this.z}).start()},this.cameraController.prototype.Move=function(t,i,e,n,o){"undefined"==typeof o&&(o=!0),"undefined"==typeof n&&(n=!0),n||(t=this.camera.position.x+t,i=this.camera.position.x+i,e=this.camera.position.x+e),"undefined"!=typeof t&&(this.HitTestX(t)||!o||n)&&(this.camera.position.x=t,this.light.position.x=t),"undefined"!=typeof i&&(this.HitTestY(i)||!o||n)&&(this.camera.position.y=i,this.light.position.y=i),"undefined"!=typeof e&&(this.HitTestZ(e)||!o||n)&&(this.camera.position.z=e),console.log("Move: X:"+t+",Y:"+i+",Z:"+e)},this.cameraController.prototype.Rotate=function(t,i,e,n){"undefined"==typeof n&&(n=!0),n||(t=this.camera.position.x+t,i=this.camera.position.x+i,e=this.camera.position.x+e),"undefined"!=typeof t&&this.HitTestR(t)&&(this.camera.rotation.x=t,light.position.x=t),"undefined"!=typeof i&&this.HitTestR(i)&&(this.camera.rotation.y=i,light.position.y=i),"undefined"!=typeof e&&this.HitTestR(e)&&(this.camera.rotation.z=e),console.log("Rotate: X:"+t+",Y:"+i+",Z:"+e)},this.cameraController.prototype.HitTestX=function(t){return t>=this.constraints.X1&&t<=this.constraints.X2},this.cameraController.prototype.HitTestY=function(t){return t>=this.constraints.Y1&&t<=this.constraints.Y2},this.cameraController.prototype.HitTestZ=function(t){return t>=this.constraints.Z1&&t<=this.constraints.Z2},this.cameraController.prototype.HitTestR=function(t){return t>=this.constraints.R1&&Z<=this.constraints.R2},this.cityController=function(){this.cities=[],this.city=void 0},this.cityController.prototype.GetCityByTag=function(t){if("default"==t)return-1;for(var i in this.cities)if("undefined"!=typeof this.cities[i].tag&&this.cities[i].tag==t)return this.cities[i];return 0},this.cityController.prototype.SpawnCity=function(i,e,n,o,s,r){var a=new t.city(i,e,o,s,r);return a.tag=n,this.cities.push(a),a.index=this.cities.length,1==this.cities.length&&(this.city=a),a},this.cityController.prototype.SetCityByIndex=function(t){this.city=t<=this.cities.length?cities[t]:cities.length},this.cityController.prototype.SetCityByTag=function(t){if("string"==typeof t)for(var i in this.cities)if("undefined"!=typeof this.cities[i].tag&&this.cities[i].tag==t)return this.city=this.cities[i],1;return 0},this.cityController.prototype.SetCity=function(t){return"undefined"!=typeof t&&t.index&&t.index<=this.cities.length?(this.city=this.cities[t.index],1):(console.log("Error (cityController.SetCity): Tried to set a city with an out of range index"),0)},this.city=function(t,i,e,n,o){this.logMatrix=function(t){for(var i in t)for(var e in i)console.log(t[i][e])},this.index=void 0,this.tag="default",this.buildings=[],this.buildingData=o.slice(),this.extents={X1:0,Y1:0,X2:0,Y2:0,Z1:0,Z2:0},this.origin={X:e,Y:n},this.midpoint={X:0,Y:0},this.buildingsPerRow=buildingsPerRow,this.buildingsPerColumn=i,this.init3D()},this.city.prototype.init3D=function(){var i=gridSizex-boxwidth,e=gridSizey-boxheight,n=jitterX,o=jitterY;this.drawMatrix=math.zeros(this.buildingsPerRow,this.buildingsPerColumn),this.dataMatrix=math.zeros(1,this.buildingData.length),camMinHeight=0;for(var s=this.buildingData.length,r=!1,a=0,h=1;h<=this.buildingsPerColumn;h++){for(var d=this.buildingsPerRow;d>=1;d--){var c={},f=new t.building(this.buildingData[a]);if("undefined"==typeof f){r=!0;break}if(!(this.drawMatrix.subset(math.index(h-1,this.buildingsPerRow-d))>0)){this.drawMatrix.subset(math.index(h-1,this.buildingsPerRow-d),Math.max(f.xsize,f.ysize));var p;if(f.ysize>1)for(p=1;p<=f.xsize;p++)this.drawMatrix.subset(math.index(h+p-1,this.buildingsPerRow-d),Math.max(f.xsize,f.ysize));if(f.xsize>1)for(p=1;p<=f.ysize;p++)this.drawMatrix.subset(math.index(h-1,this.buildingsPerRow-d+p),Math.max(f.xsize,f.ysize));this.dataMatrix.subset(math.index(0,s-this.buildingData.length),Math.max(f.xsize,f.ysize)),this.buildingData.splice(a,1),n*=-1,o*=-1;var u=e*(f.ysize-1)+boxheight*f.ysize,l=i*(f.xsize-1)+boxwidth*f.xsize,y=3*Math.random()+1;y/2+1>camMinHeight&&(camMinHeight=Math.ceil(y/2+1)),c.geometry=new THREE.BoxGeometry(l,u,y);var x=parseInt(f.hex_color,16);if(c.material=[new THREE.MeshLambertMaterial({color:x}),new THREE.MeshLambertMaterial({color:x}),new THREE.MeshLambertMaterial({color:x}),new THREE.MeshLambertMaterial({color:x}),new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(f.img)}),new THREE.MeshLambertMaterial({color:x})],c.material[4].minFilter=THREE.NearestFilter,c.cube=new THREE.Mesh(c.geometry,new THREE.MeshFaceMaterial(c.material)),c.cube.name=f.id,scene.add(c.cube),c.cube.position.x=this.origin.X+(-d*gridSizex- -(f.xsize-1)*gridSizex/2+n),c.cube.position.y=this.origin.Y+(-h*gridSizey-(f.ysize-1)*gridSizey/2+o),c.cube.position.x<this.extents.X1&&(this.extents.X1=c.cube.position.x),c.cube.position.x+l>this.extents.X2&&(this.extents.X2=c.cube.position.x+l),c.cube.position.y<this.extents.Y1&&(this.extents.Y1=c.cube.position.y),c.cube.position.y+u>this.extents.Y2&&(this.extents.Y2=c.cube.position.y+u),c.cube.position.z<this.extents.Z1&&(this.extents.Z1=c.cube.position.z),c.cube.position.z+y>this.extents.Z2&&(this.extents.Z2=c.cube.position.z+y),f.SetModel(c.cube),this.buildings[parseInt(f.id)]=f,objects.push(c.cube),r)break}}if(r)break}this.midpoint.X=(this.extents.X2+this.extents.X1)/2,this.midpoint.Y=(this.extents.Y2+this.extents.Y1)/2},this.building=function(t){"undefined"!=typeof t&&(this.xsize="undefined"==typeof t.xsize?void 0:t.xsize,this.ysize="undefined"==typeof t.ysize?void 0:t.ysize,this.id="undefined"==typeof t.id?void 0:t.id,this.title="undefined"==typeof t.title?void 0:t.title,this.description="undefined"==typeof t.description?void 0:t.description,this.tags="undefined"==typeof t.tags?void 0:t.tags,this.img="undefined"==typeof t.img?void 0:t.img,this.hex_color="undefined"==typeof t.hex_color?void 0:t.hex_color),this.model=void 0},this.building.prototype.SetModel=function(t){this.model=t}};