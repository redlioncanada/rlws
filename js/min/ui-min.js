function keywordReturn(e){$("#search-back-text span").html(e),$("#search-back-img, #search-back-text").css("display","block").velocity({opacity:"1"},{duration:400,delay:4500})}function keywordHide(){$("#search-back-img, #search-back-text").velocity({opacity:"0"},{duration:400,complete:function(){$(this).css("display","none")}})}function _webGLResizeAnon(){$(e).css("padding-top",$("#loading").height()/2-$(e).height()/2-60+"px")}function closeMenu(){$("#menu a").removeClass("active"),$(".contact a, .culture a, .careers a").off("click"),$(".culture button").off("click"),$(".menu-item").each(function(){$(this).css("z-index",250).velocity({top:headerHeight-$(this).height()},{duration:300})}),lastMenuItem=""}function scrollTop(){$("html, body").velocity({scrollTop:0},{duration:500})}function initGoogleMap(){var e=document.getElementById("map-canvas"),t=new google.maps.Map(e,{center:new google.maps.LatLng(43.6533998,-79.3742563),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,backgroundColor:"#fffdf2",disableDefaultUI:!0}),a=new google.maps.Marker({position:new google.maps.LatLng(43.6533998,-79.3742563),map:t,icon:"img/map-marker.png"});t.set("styles",[{stylers:[{visibility:"simplified"},{saturation:-100},{weight:4.2}]},{elementType:"labels.icon",stylers:[{saturation:-95},{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}]);var o=setInterval(function(){var e=$(".gm-style");$(e).length&&($(e).css("opacity",1),googleMapLoaded=!0,clearInterval(o))},100)}function loadGoogleMap(){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?v=3.exp&callback=initGoogleMap",document.body.appendChild(e)}if(window.fbAsyncInit=function(){FB.init({appId:"738219399610044",xfbml:!0,version:"v2.2"})},function(e,t,a){var o,i=e.getElementsByTagName(t)[0];e.getElementById(a)||(o=e.createElement(t),o.id=a,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk"),$("#searchCancel, #search-back-img").on("click",function(e){te("search","search-return"),cameraController.animating||($("#searchTerm").val(""),$("#cachedTerm").val(""),SpawnAndGoToCity(),$("#searchCancel, #search-back-img, #search-back-text").velocity({opacity:"0"},{duration:400,complete:function(){$("#search-back-text span").html(""),$(this).css("display","none")}}))}),$("#logo").click(function(e){te("logo","logo-clicked"),location.reload()}),$("#searchTerm").on("keypress",function(e){te("logo","logo-clicked"),$(this).val().length||$("#cachedTerm").val(""),e.preventDefault()}).on("keydown",function(e){function t(){var e=dataController.GetIdsWithTag(o);0==e.length?$("#cachedTerm").val(""):"undefined"==typeof e[0]&&$("#cachedTerm").val("");var t=!1;for(var a in e){var i=e[a].split(", ");for(var n in i)i[n].substring(0,o.length)==o&&($("#cachedTerm").val(i[n]),t=!0)}t||$("#cachedTerm").val("")}function a(e,t){var a=e.which||e.keyCode;a>=65&&90>=a?(a=String.fromCharCode(a).toLowerCase(),$(t).val($(t).val()+a)):189==a&&$(t).val($(t).val()+"-")}te("search","search-clicked"),a(e,this);var o=$(this).val(),i=$("#cachedTerm").val();if($(this).val().length>32){var n=o;n=n.substring(0,n.length-1),$(this).val(n)}if(t(),13==e.keyCode&&$(this).val().length){if(!cameraController)return;if(cameraController.animating)return;if($("#cachedTerm").val().length||o==homeKeyword){if(te("search","search-submitted",i),cityController.city&&cityController.city.tag==i)return $(this).val("").blur(),void $("#cachedTerm").val("");var c=SpawnAndGoToCity(i);return c&&o!=homeKeyword?keywordReturn(i):c&&o==homeKeyword&&keywordHide(),$(this).val("").blur(),void $("#cachedTerm").val("")}return void $(this).val(cityController.city.tag)}if(9==e.keyCode&&o.length>0||39==e.keyCode){e.preventDefault();var r=$("#cachedTerm").val();$(this).val(r)}else 8==e.keyCode?($("#cachedTerm").val(""),o.length-1>0&&t()):27==e.keyCode&&($("#cachedTerm").val(""),$(this).val(""))}).on("focus",closeMenu),Detector.webgl)$(canvasDiv).append(renderer.domElement);else{$("#loading").css({"background-image":'url("./img/rl_wordmark_transparent.png")',"background-repeat":"no-repeat","background-position":"center center","background-attachment":"fixed"});var e=Detector.addGetWebGLMessage({parent:$("#loading")});$(window).on("resize",_webGLResizeAnon),_webGLResizeAnon(),$(e).css("display","block").velocity({opacity:"1"},{duration:1e3})}var headerHeight=$("#main-header").outerHeight()-2,lastMenuItem,mapInterval=!1;$(".menu-item").each(function(){$(this).css("top",headerHeight-$(this).height())}),$("#menu a").click(function(){function e(){$("#menu a").removeClass("active"),$(".menu-item").not("."+a).each(function(){$(this).css("z-index",250).velocity({top:headerHeight-$(this).height()},{duration:300})}),lastMenuItem!=a?($(t).addClass("active"),$(".menu-item."+a).css("z-index",251).velocity({top:headerHeight+1},{duration:300}),lastMenuItem=a):closeMenu()}var t=this,a=$(this).attr("class").replace(" active","");if(te(a,"menu-clicked"),googleMapLoaded||"contact"!=a)e();else if(!mapInterval){loadGoogleMap();var o=0;mapInterval=setInterval(function(){(googleMapLoaded||++o>10)&&(clearInterval(mapInterval),mapInterval=!1,e())},300)}"contact"==a||"careers"==a?$("."+a+" a").on("click",function(e){te(a,"email-clicked")}):"culture"==a&&$(".culture button").on("click",function(e){te(a,$(this).attr("aria-label")+"-clicked")})}),$(".menu-item-footer,.mobile-menu-item-footer").click(function(){closeMenu(),scrollTop()}),$("#canvas").on("mousedown",closeMenu),dataController.on("loaded",function(){$("#loadinglogo").velocity({opacity:0},{duration:800,complete:function(){clearInterval(brentSpinner),$("#loadinglogo").css("display","none"),$("#loading").velocity({opacity:"0"},{duration:1200,complete:function(){$("#loading").css("display","none")}})}})},"overlay"),$("#mobile-menu").click(function(){$(".mobile").click()}),$(".mobile-menu-item-header").click(function(){var e=$(this).attr("class").replace("mobile-menu-item-header ","");closeMenu(),$("#menu ."+e).click()}),$("#content").css("height",window.innerHeight-headerHeight),$(window).on("resize",function(){$("#content").css("height",window.innerHeight-headerHeight)});var googleMapLoaded=!1;indicator.on("show",function(){var e=$("#indicator");$(e).hasClass("velocity-animating")||1===$(e).css("opacity")||$(e).velocity({opacity:1},{duration:200,queue:!1})}),indicator.on("hide",function(){var e=$("#indicator");$("#indicator").hasClass("velocity-animating")||0===$(e).css("opacity")||$("#indicator").velocity({opacity:0},{duration:200,queue:!1})}),indicator.on("update",function(){function e(e,t,a){d.fillStyle=a||"black",d.beginPath(),d.arc(e,t,10,0,2*Math.PI,!0),d.fill()}function t(e,t){t=t||"black",d.strokeStyle=t,d.beginPath(),d.moveTo(e.X1,e.Y1),d.lineTo(e.X2,e.Y2),d.lineWidth=5,d.stroke()}var a=$("#canvas"),o=parseInt($(a).width()),i=parseInt($(a).height()),n=parseInt($(a).position().top),c=parseInt($(a).position().left),r=this.GetPosition({left:0,width:o,top:0,height:i});if(cityController.city&&cityController.defaultCity){if(r&&!cityController.CityIsInView(homeKeyword,10)){this.Show();var l=$("#indicator");0!=r.rotation||$(l).hasClass("rotateUp")?90!=r.rotation||$(l).hasClass("rotateLeft")?180!=r.rotation||$(l).hasClass("rotateDown")?270!=r.rotation||$(l).hasClass("rotateRight")||$(l).removeClass("rotateUp rotateDown rotateLeft rotateRight").addClass("rotateRight"):$(l).removeClass("rotateUp rotateDown rotateLeft rotateRight").addClass("rotateDown"):$(l).removeClass("rotateUp rotateDown rotateLeft rotateRight").addClass("rotateLeft"):$(l).removeClass("rotateUp rotateDown rotateLeft rotateRight").addClass("rotateUp"),$(l).css({left:0==r.X?r.X+c:r.X-$(l).width()+c,top:0==r.Y?r.Y+n:r.Y-$(l).height()+n})}else this.Hide();if(debugIndicator){$("#test").length||$("#content").append('<canvas id="test" style="position:absolute;"></canvas>'),$("#test").css({left:$(a).position().left,width:o,top:$(a).position().top,height:i});var s=document.getElementById("test"),d=s.getContext("2d");s.width=o,s.height=i,d.clearRect(0,0,o,i),t(this.colliderLine,"red"),t(this.raycastLine,"blue"),r&&e(r.X,r.Y,"green")}}}),$("#indicator").click(function(){SpawnAndGoToCity(homeKeyword),te("search","search-return")}),$("#culture-inner").slick({dots:!0,infinite:!0,speed:500,slidesToShow:1}),$("#blackout").on("click",function(e){e.stopPropagation(),"blackout"==$($(e.target).context).attr("id")&&(te("overlay","close-clicked-blackout"),cameraController.AnimateBlur(0,1),$(this).velocity({opacity:0,"padding-top":50},{duration:1e3,easing:"easeOutCubic",complete:function(){$("#blackout").scrollTop(0),$(this).css({display:"none"}),window.location.href="#/grid"}}))});var w=[83,65,82,67,65,83,77],cw=0;$(document).on("keydown",function(e){$("#discipline-overlay").length&&!$(".sarcasm").length&&e.keyCode==w[cw++]?cw==w.length&&(cw=0,$("#discipline-overlay header").after('<div class="dcontainer sarcasm" ng-repeat="disc in disciplines"><h1 class="ng-binding"><span>+</span> &nbsp;Sarcasm</h1><p style="display:none;" class="ng-binding">We never use sarcasm in any way, shape or form. There is no room for humour in a professional environment, and sarcasm is the lowest form of humour. Sarcasm is basically lying. If you work with Red Lion, you can rest assured that this disgusting practice will not be employed.<br/>#stopsarcasm</p></div>'),$("#blackout").animate({scrollTop:0},500)):cw=0});