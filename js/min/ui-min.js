function _webGLResizeAnon(){$(e).css("padding-top",$("#loading").height()/2-$(e).height()/2-60+"px")}function closeMenu(){$("#menu a").removeClass("active"),$(".menu-item").each(function(){$(this).css("z-index",250).velocity({top:headerHeight-$(this).height()},{duration:300})}),lastMenuItem=""}function scrollTop(){$("html, body").velocity({scrollTop:0},{duration:500})}function initGoogleMap(){var e=document.getElementById("map-canvas"),t=new google.maps.Map(e,{center:new google.maps.LatLng(43.6533998,-79.3742563),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,backgroundColor:"#fffdf2",disableDefaultUI:!0}),a=new google.maps.Marker({position:new google.maps.LatLng(43.6533998,-79.3742563),map:t,icon:"img/map-marker.png"});t.set("styles",[{stylers:[{visibility:"simplified"},{saturation:-100},{weight:4.2}]},{elementType:"labels.icon",stylers:[{saturation:-95},{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}]);var n=setInterval(function(){var e=$(".gm-style");$(e).length&&($(e).css("opacity",1),googleMapLoaded=!0,clearInterval(n))},100)}function loadGoogleMap(){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?v=3.exp&callback=initGoogleMap",document.body.appendChild(e)}if(window.fbAsyncInit=function(){FB.init({appId:"738219399610044",xfbml:!0,version:"v2.2"})},function(e,t,a){var n,o=e.getElementsByTagName(t)[0];e.getElementById(a)||(n=e.createElement(t),n.id=a,n.src="//connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(n,o))}(document,"script","facebook-jssdk"),isMobile&&$("#controls").css("display","none"),$("#searchCancel").on("click",function(e){cameraController.animating||($("#searchTerm").val(""),$("#cachedTerm").val(""),SpawnAndGoToCity(homeKeyword),$("#searchCancel").velocity({opacity:"0"},{duration:400,complete:function(){$(this).css("display","none")}}))}),$("#searchTerm").on("keydown",function(e){var t=$(this).val(),a=$("#cachedTerm").val();if($(this).val().length>32){var n=t;n=n.substring(0,n.length-1),$(this).val(n)}if(13==e.keyCode&&$(this).val().length){if(cameraController.animating)return;if($("#cachedTerm").val().length||$(this).val()==homeKeyword){var o=SpawnAndGoToCity(a);return o&&t!=homeKeyword?$("#searchCancel").css("display","block").velocity({opacity:"1"},{duration:400}):o&&t==homeKeyword&&$("#searchCancel").velocity({opacity:"0"},{duration:400,complete:function(){$(this).css("display","none")}}),void $(this).val($("#cachedTerm").val()).blur()}return void $(this).val(cityController.city.tag)}if(9==e.keyCode&&t.length>0||39==e.keyCode){e.preventDefault();var i=$("#cachedTerm").val();$(this).val(i)}else 8==e.keyCode&&$("#cachedTerm").val("")}),$("#searchTerm").on("input",function(e){var t=$(this).val(),a=dataController.GetIdsWithTag(t);if(0==a.length)return void $("#cachedTerm").val("");if("undefined"==typeof a[0])return void $("#cachedTerm").val("");for(var n in a){var o=a[n].split(", ");for(var i in o)if(o[i].substring(0,t.length)==t)return void $("#cachedTerm").val(o[i])}$("#cachedTerm").val("")}).on("focus",closeMenu),Detector.webgl)$(canvasDiv).append(renderer.domElement),setTimeout(function(){$("#loading").velocity({opacity:"0"},{duration:1e3})},2e3);else{$("#loading").css({"background-image":'url("./img/rl_wordmark_transparent.png")',"background-repeat":"no-repeat","background-position":"center center","background-attachment":"fixed"});var e=Detector.addGetWebGLMessage({parent:$("#loading")});$(window).on("resize",_webGLResizeAnon),_webGLResizeAnon(),$(e).css("display","block").velocity({opacity:"1"},{duration:1e3})}var headerHeight=$("#main-header").outerHeight()-2,lastMenuItem,mapInterval=!1;$(".menu-item").each(function(){$(this).css("top",headerHeight-$(this).height())}),$("#menu a").click(function(){function e(){$("#menu a").removeClass("active"),$(".menu-item").not("."+a).each(function(){$(this).css("z-index",250).velocity({top:headerHeight-$(this).height()},{duration:300})}),lastMenuItem!=a?($(t).addClass("active"),$(".menu-item."+a).css("z-index",251).velocity({top:headerHeight+1},{duration:300}),lastMenuItem=a):closeMenu()}var t=this,a=$(this).attr("class").replace(" active","");if(googleMapLoaded||"contact"!=a)e();else if(!mapInterval){loadGoogleMap();var n=0;mapInterval=setInterval(function(){(googleMapLoaded||++n>10)&&(clearInterval(mapInterval),mapInterval=!1,e())},300)}}),$(".menu-item-footer").click(function(){closeMenu(),scrollTop()}),$("#canvas").on("mousedown",closeMenu),$("#content").css("height",window.innerHeight-headerHeight),$(window).on("resize",function(){$("#content").css("height",window.innerHeight-headerHeight)});var googleMapLoaded=!1;$("#blackout").on("click",function(e){e.stopPropagation(),"blackout"==$($(e.target).context).attr("id")&&(cameraController.AnimateBlur(0,1),$(this).velocity({opacity:0,"padding-top":50},{duration:1e3,easing:"easeOutCubic",complete:function(){$(this).css({display:"none"}),window.location.href="#/grid"}}))});var w=[83,65,82,67,65,83,77],cw=0;$(document).on("keydown",function(e){$("#discipline-overlay").length&&!$(".sarcasm").length&&e.keyCode==w[cw++]?cw==w.length&&(cw=0,$("#discipline-overlay header").after('<div class="dcontainer sarcasm" ng-repeat="disc in disciplines"><h1 class="ng-binding"><span>+</span> &nbsp;Sarcasm</h1><p style="display:none;" class="ng-binding">We never use sarcasm in any way, shape or form. There is no room for humour in a professional environment, and sarcasm is the lowest form of humour. Sarcasm is basically lying. If you work with Red Lion, you can rest assured that this disgusting practice will not be employed.<br/>#stopsarcasm</p></div>'),$("#blackout").animate({scrollTop:0},500)):cw=0});