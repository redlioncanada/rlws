function render(){requestAnimationFrame(render),TWEEN.update(),Math.abs(camera.position.y)>=Math.abs(originY-camY2Extents)&&(mDOWN=!1),Math.abs(camera.position.y)<=Math.abs(originY+camY1Extents)&&(mUP=!1),Math.abs(camera.position.x)>=Math.abs(originX-camX1Extents)&&(mLEFT=!1),Math.abs(camera.position.x)<=Math.abs(originX+camX2Extents)&&(mRIGHT=!1),overlay||(!xMove&&mRIGHT&&moveCamX(.1),!xMove&&mLEFT&&moveCamX(-.1),!yMove&&mUP&&moveCamY(.1),!yMove&&mDOWN&&moveCamY(-.1),mGOIN&&(camera.position.z-=.1),mGOOUT&&(camera.position.z+=.1),xMove&&(mLEFT||mRIGHT)&&moveCamX(xMove/200*-1),yMove&&(mUP||mDOWN)&&moveCamY(yMove/200),mROTUP&&camera.rotation.x<.9&&(camera.rotation.x+=.03),mROTDOWN&&camera.rotation.x>0&&(camera.rotation.x-=.03),renderer.render(scene,camera))}function init3D(){var e=new THREE.PlaneBufferGeometry(100,100),a=new THREE.MeshPhongMaterial({color:16776690,side:THREE.DoubleSide}),i=new THREE.Mesh(e,a);scene.add(i),i.position.z=-.2,light=new THREE.PointLight(16777215,1,50),light.position.set(0,0,4),scene.add(light),camera.position.z=camZStart,initInterval=setInterval(function(){glCards.length>0&&(clearInterval(initInterval),initBuildings())},500),render()}function animateCameraZoom(e,a){var i=new TWEEN.Tween({z:e}).to({z:a},1e3*camZAnimationTime).easing(TWEEN.Easing.Elastic.InOut).onUpdate(function(){camera.position.z=this.z}).start()}function animateCameraPosition(e,a){}function initBuildings(){var e=math.zeros(maxX,maxY),a=math.zeros(1,glCards.length);camMinHeight=0;for(var i=glCards.slice(),t=i.length,r=jitterX,n=jitterY,o=!1,m=0,s=1;s<=maxY;s++){for(var c=maxX;c>=1;c--){var d={},h=i[m];if("undefined"==typeof h){o=!0;break}if(!(e.subset(math.index(s-1,maxX-c))>0)){if(e.subset(math.index(s-1,maxX-c),Math.max(h.xsize,h.ysize)),h.ysize>1)for(var l=1;l<=h.xsize;l++)e.subset(math.index(s+l-1,maxX-c),Math.max(h.xsize,h.ysize));if(h.xsize>1)for(var l=1;l<=h.ysize;l++)e.subset(math.index(s-1,maxX-c+l),Math.max(h.xsize,h.ysize));a.subset(math.index(0,t-i.length),Math.max(h.xsize,h.ysize)),i.splice(m,1),r*=-1,n*=-1;var g=gutterY*(h.ysize-1)+boxheight*h.ysize,x=gutterX*(h.xsize-1)+boxwidth*h.xsize,E=3*Math.random()+1;E/2+1>camMinHeight&&(camMinHeight=Math.ceil(E/2+1)),d.geometry=new THREE.BoxGeometry(x,g,E);var M=colors[Math.round(Math.random())];if(d.material=[new THREE.MeshLambertMaterial({color:M}),new THREE.MeshLambertMaterial({color:M}),new THREE.MeshLambertMaterial({color:M}),new THREE.MeshLambertMaterial({color:M}),new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(h.img)}),new THREE.MeshLambertMaterial({color:M})],d.material[4].minFilter=THREE.NearestFilter,d.cube=new THREE.Mesh(d.geometry,new THREE.MeshFaceMaterial(d.material)),d.cube.name=t-i.length,scene.add(d.cube),objects.push(d.cube),d.cube.position.x=-c*gridSizex-(h.xsize-1)*gridSizex/2+r,d.cube.position.y=-s*gridSizey-(h.ysize-1)*gridSizey/2+n,logMatrix(e),logMatrix(a),o)break}}if(o)break}moveCamAbs(-(gridTotalWidth/2),-(gridTotalHeight/2)),camMinX=-gridTotalWidth-camX1Extents,camMaxX=0+camX2Extents,camMinY=-gridTotalHeight-camY1Extents,camMaxY=0+camY2Extents,originX=camera.position.x,originY=camera.position.y,animateCameraZoom(camera.position.z,camZEnd)}function logMatrix(e){for(var a in e)for(var i in a)console.log(e[a][i])}var camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e4),scene=new THREE.Scene;scene.fog=new THREE.FogExp2(16776690,.18);var renderer=new THREE.WebGLRenderer({antialias:!0}),light=null,objects=[],gutterX=gridSizex-boxwidth,gutterY=gridSizey-boxheight,gridTotalWidth=maxX*(gridSizex+gutterX),gridTotalHeight=maxY*(gridSizey+gutterY),initInterval;renderer.setSize(window.innerWidth,window.innerHeight-73),renderer.shadowMapEnabled=!0,document.body.appendChild(renderer.domElement),setupEventListeners();