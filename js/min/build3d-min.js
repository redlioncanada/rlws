function moveCamX(e){camera.position.x+=e,light.position.x+=e}function moveCamY(e){camera.position.y+=e,light.position.y+=e}function render(){requestAnimationFrame(render),overlay||(mRIGHT&&moveCamX(.1),mLEFT&&moveCamX(-.1),mUP&&moveCamY(.1),mDOWN&&moveCamY(-.1),mGOIN&&(camera.position.z-=.1),mGOOUT&&(camera.position.z+=.1),xMove&&moveCamX(xMove/200*-1),yMove&&moveCamY(yMove/200),mROTUP&&camera.rotation.x<.9&&(camera.rotation.x+=.03),mROTDOWN&&camera.rotation.x>0&&(camera.rotation.x-=.03),renderer.render(scene,camera))}function boxClicked(e){console.log(glCards[parseInt(e.name)]),$("#blackout").css({display:"block"}).animate({opacity:1},500),overlay=!0,$("#overlay").html("box clicked: "+e.name+"<br>Content title: "+glCards[parseInt(e.name)].title+"<br>Description: "+glCards[parseInt(e.name)].description+'<br>Image: <img src="'+glCards[parseInt(e.name)].img+'">'),$("#blackout").on("click",function(e){$(this).animate({opacity:0},500,function(){$("#blackout").css({display:"none"}),overlay=!1}),$(this).unbind("click")})}function onDocumentMouseDown(e,o){if(!overlay){if("undefined"==typeof o){var n=e.clientX/window.innerWidth*2-1,t=2*-(e.clientY/window.innerHeight)+1;o=new THREE.Vector3(n,t,.5)}var a=new THREE.Raycaster;o.unproject(camera),a.set(camera.position,o.sub(camera.position).normalize());var i=a.intersectObjects(objects);i.length>0&&boxClicked(i[0].object)}}function init3D(){document.addEventListener("mousedown",onDocumentMouseDown);var e=new THREE.PlaneBufferGeometry(100,100),o=new THREE.MeshPhongMaterial({color:16776690,side:THREE.DoubleSide}),n=new THREE.Mesh(e,o);scene.add(n),n.position.z=-.2;var t,a;for(t=1;maxX>=t;t++)for(a=1;maxY>=a;a++){var i={};i.geometry=new THREE.BoxGeometry(boxwidth,boxheight,3*Math.random()+1),i.material=new THREE.MeshLambertMaterial({color:colors[Math.round(Math.random())]}),i.cube=new THREE.Mesh(i.geometry,i.material),i.cube.name=(t-1)*maxX+a,scene.add(i.cube),objects.push(i.cube),i.cube.position.x=t*gridSizex,i.cube.position.y=a*gridSizey}light=new THREE.PointLight(16777215,1,50),light.position.set(0,0,4),scene.add(light),camera.position.z=5,render()}var mUP=!1,mDOWN=!1,mRIGHT=!1,mLEFT=!1,mGOIN=!1,mGOOUT=!1,mROTUP=!1,mROTDOWN=!1,camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e4),scene=new THREE.Scene;scene.fog=new THREE.FogExp2(16776690,.25);var renderer=new THREE.WebGLRenderer,light=null,objects=[],gridSizex=1.2,gridSizey=1.5,maxX=6,maxY=6,colors=[14755101,3909315],boxheight=1.3,boxwidth=1,oldTouchX=0,oldTouchY=0,xMove=0,yMove=0,mTouchDown=!1,mTouchMove=!1,overlay=!1;renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMapEnabled=!0,document.body.appendChild(renderer.domElement),$(document).keydown(function(e){38==e.which&&(e.preventDefault(),mUP=!0),40==e.which&&(e.preventDefault(),mDOWN=!0),37==e.which&&(e.preventDefault(),mLEFT=!0),39==e.which&&(e.preventDefault(),mRIGHT=!0),34==e.which&&(e.preventDefault(),mGOIN=!0),33==e.which&&(e.preventDefault(),mGOOUT=!0),36==e.which&&(e.preventDefault(),mROTUP=!0),35==e.which&&(e.preventDefault(),mROTDOWN=!0)}),$(document).keyup(function(e){38==e.which&&(e.preventDefault(),mUP=!1),40==e.which&&(e.preventDefault(),mDOWN=!1),37==e.which&&(e.preventDefault(),mLEFT=!1),39==e.which&&(e.preventDefault(),mRIGHT=!1),34==e.which&&(e.preventDefault(),mGOIN=!1),33==e.which&&(e.preventDefault(),mGOOUT=!1),36==e.which&&(e.preventDefault(),mROTUP=!1),35==e.which&&(e.preventDefault(),mROTDOWN=!1)}),document.addEventListener("touchstart",function(e){e.preventDefault();var o=e.touches[0];oldTouchX=o.pageX,oldTouchY=o.pageY,mTouchDown=!0},!1),document.addEventListener("touchend",function(e){e.preventDefault();var o=e.touches[0];if(1>xMove&&xMove>-1&&1>yMove&&yMove>-1){var n=e.pageX/window.innerWidth*2-1,t=2*-(e.pageY/window.innerHeight)+1,a=new THREE.Vector3(n,t,.5);onDocumentMouseDown(e,a)}xMove=0,yMove=0},!1),document.addEventListener("touchmove",function(e){e.preventDefault();var o=e.touches[0];xMove=o.pageX-oldTouchX,oldTouchX=o.pageX,yMove=o.pageY-oldTouchY,oldTouchY=o.pageY,mTouchMove=!0},!1);