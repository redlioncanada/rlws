function resize(){camera.aspect=canvasDiv.width()/canvasDiv.height(),renderer.setSize(canvasDiv.width(),canvasDiv.height()),camera.updateProjectionMatrix()}function render(){requestAnimationFrame(render),TWEEN.update();var e=(new Date).getTime()/1e3;if(frameTime=e-currentTime,currentTime=e,totalTime+=frameTime,!overlay){var a=xMove?-(xMove/200):.1;mLEFT&&!xMove&&(a*=-1);var t=yMove?yMove/200:.1;mDOWN&&!yMove&&(t*=-1),(mLEFT||mRIGHT)&&cameraController.Move(a,void 0,void 0,!1),(mUP||mDOWN)&&cameraController.Move(void 0,t,void 0,!1),mGOIN&&cameraController.Zoom(.1),mGOOUT&&cameraController.Zoom(-.1),mROTUP&&cameraController.Rotate(.03,void 0,void 0,!1),mROTDOWN&&cameraController.Rotate(-.03,void 0,void 0,!1),composer.render(.1)}}function init3D(){if(Detector.webgl){resize(),composer=new THREE.EffectComposer(renderer);var e=new THREE.RenderPass(scene,camera);composer.addPass(e);var a=new THREE.ShaderPass(THREE.VignetteShader);a.uniforms.darkness.value=1.5,composer.addPass(a);var t=new THREE.ShaderPass(THREE.CopyShader);t.renderToScreen=!0,composer.addPass(t);var r=new THREE.ImageUtils.loadTexture("testcloud.png"),o=new THREE.MeshBasicMaterial({map:r});o.transparent=!0;var n=new THREE.PlaneBufferGeometry(64,64,1,1);cube2=new THREE.Mesh(n,o),cube2.position.set(15,14,50),scene.add(cube2);var i=new THREE.PlaneBufferGeometry(1e4,1e4),s=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide});plane=new THREE.Mesh(i,s),scene.add(plane),plane.position.z=12;var l=new THREE.ObjectLoader;l.load("models/rllogo2.json",function(e){scene.add(e),e.position.set(-300,-90,80),e.scale.set(.5,.5,.5)}),spotLight.position.set(0,40,80),spotLight.target.position.set(40,0,0),spotLight.intensity=.8,spotLight.castShadow=!0,spotLight.shadowDarkness=.3,spotLight.shadowMapWidth=1024,spotLight.shadowMapHeight=1024,spotLight.shadowCameraNear=10,spotLight.shadowCameraFar=4e4,spotLight.shadowCameraFov=30,scene.add(spotLight),hemilight=new THREE.HemisphereLight(10011597,16776690,.3),scene.add(hemilight),cameraController=new objs.cameraController(renderer,scene,camera),initInterval=setInterval(function(){glCards.length>0&&(clearInterval(initInterval),dataController.SetData(glCards),setTimeout(function(){$("#loading").fadeOut(),SpawnAndGoToCity(homeKeyword)},1e3))},500),render()}}function SpawnAndGoToCity(e){"undefined"==typeof abs&&(abs=!1);var a=cityController.CityIsSpawned(e);if(a)var t=cityController.GetCityByTag(e);else if(e==homeKeyword)var r=layout,t=cityController.SpawnCity(e,r,1);else{var r=dataController.GetAllWithTag(e);if(!r||!r.length)return void 0;var t=cityController.SpawnCity(e,r)}return r&&(r.length||Object.keys(r).length)||a?(cityController.SetCity(t),cameraController.CenterOnCity(t),t):void 0}var canvasDiv=$("#canvas"),canvas=canvasDiv.get(0),camera=new THREE.PerspectiveCamera(camFOVStart,canvasDiv.width()/canvasDiv.height(),1,300),scene=new THREE.Scene,mouse=new THREE.Vector2,intersected,raycaster=new THREE.Raycaster,renderer=new THREE.WebGLRenderer({antialias:!0}),spotLight=new THREE.SpotLight(16777215),hemilight=null,lightintensity=40,composer,initInterval,objects=[],objs=new _objects,dataController=new objs.dataController,cityController=new objs.cityController(dataController),cameraController=null,fuse,controlsinit=!1,plane;renderer.shadowMapEnabled=!0,$(window).on("resize",resize);