function spinfunction(){loopCount++;var e=180*loopCount;$("#loadinglogo").velocity({rotateZ:e},{duration:1200})}function resize(){camera.aspect=canvasDiv.width()/canvasDiv.height(),renderer.setSize(canvasDiv.width(),canvasDiv.height()),camera.updateProjectionMatrix()}function render(){if(requestAnimationFrame(render),TWEEN.update(),!mTouchDown||!overlay){raycaster.setFromCamera(mouse,camera);var e=raycaster.intersectObjects(scene.children);e.length>0&&"undefined"!=typeof e[0]&&"undefined"!=typeof e[0].face&&mouseCursor(5==e[0].face.a&&7==e[0].face.b||7==e[0].face.a&&2==e[0].face.b?"point":"grab")}var o=(new Date).getTime()/1e3;if(frameTime=o-currentTime,currentTime=o,totalTime+=frameTime,!overlay){var a=xMove?-(xMove/200):.1;mLEFT&&!xMove&&(a*=-1);var t=yMove?yMove/200:.1;mDOWN&&!yMove&&(t*=-1),(mLEFT||mRIGHT)&&cameraController.Move(a,void 0,void 0,!1),(mUP||mDOWN)&&cameraController.Move(void 0,t,void 0,!1),mGOIN&&cameraController.Zoom(.1),mGOOUT&&cameraController.Zoom(-.1),mROTUP&&cameraController.Rotate(.03,void 0,void 0,!1),mROTDOWN&&cameraController.Rotate(-.03,void 0,void 0,!1),composer.render(.1)}}function init3D(){if(Detector.webgl){resize(),composer=new THREE.EffectComposer(renderer);var e=new THREE.RenderPass(scene,camera);composer.addPass(e);var o=new THREE.ShaderPass(THREE.VignetteShader);o.uniforms.darkness.value=1.5,composer.addPass(o),hblurPass=new THREE.ShaderPass(THREE.HorizontalBlurShader),hblurPass.uniforms.h.value=0,composer.addPass(hblurPass),vblurPass=new THREE.ShaderPass(THREE.VerticalBlurShader),vblurPass.uniforms.v.value=0,composer.addPass(vblurPass);var a=new THREE.ShaderPass(THREE.CopyShader);a.renderToScreen=!0,composer.addPass(a);var t=new THREE.ImageUtils.loadTexture("img/cloud1.png"),n=new THREE.MeshBasicMaterial({map:t});n.transparent=!0;var r=new THREE.PlaneBufferGeometry(64,64,1,1),s=new THREE.ImageUtils.loadTexture("img/cloud2.png"),i=new THREE.MeshBasicMaterial({map:s});i.transparent=!0;var l=new THREE.ImageUtils.loadTexture("img/cloud3.png"),d=new THREE.MeshBasicMaterial({map:l});d.transparent=!0,cloud1=new THREE.Mesh(r,d),cloud1.position.set(16,16,30),scene.add(cloud1),cloud2=new THREE.Mesh(r,i),cloud2.position.set(2,0,38),cloud2.rotation.z=3.5,scene.add(cloud2),cloud3=new THREE.Mesh(r,d),cloud3.position.set(30,2,45),scene.add(cloud3),cloud4=new THREE.Mesh(r,i),cloud4.position.set(30,30,50),scene.add(cloud4),cloud5=new THREE.Mesh(r,n),cloud5.position.set(-5,40,55),cloud5.rotation.z=3.5,scene.add(cloud5),cloud6=new THREE.Mesh(r,i),cloud6.position.set(55,15,58),scene.add(cloud6),cloud7=new THREE.Mesh(r,d),cloud7.position.set(-25,15,61),scene.add(cloud7),cloud8=new THREE.Mesh(r,n),cloud8.position.set(15,50,68),cloud8.rotation.z=3.5,scene.add(cloud8),cloud9=new THREE.Mesh(r,n),cloud9.position.set(16,-15,73),scene.add(cloud9);var c=new THREE.PlaneBufferGeometry(1e4,1e4),u=new THREE.MeshLambertMaterial({color:8947848,side:THREE.DoubleSide});plane=new THREE.Mesh(c,u),scene.add(plane),plane.receiveShadow=!0,plane.position.z=groundZ,spotLight.position.set(0,40,80),spotLight.target.position.set(40,0,0),spotLight.intensity=.8,spotLight.castShadow=!0,spotLight.shadowDarkness=.3,spotLight.shadowMapWidth=1024,spotLight.shadowMapHeight=1024,spotLight.shadowCameraNear=10,spotLight.shadowCameraFar=4e4,spotLight.shadowCameraFov=55,scene.add(spotLight),hemilight=new THREE.HemisphereLight(10011597,16776690,.3),scene.add(hemilight),cameraController=new objs.cameraController(renderer,scene,camera),initInterval=setInterval(function(){glCards.length>0&&(clearInterval(initInterval),dataController.SetData(glCards),setTimeout(function(){SpawnAndGoToCity(homeKeyword)},1e3))},500),render()}}function SpawnAndGoToCity(e){var o=cityController.CityIsSpawned(e);if(o)var a=cityController.GetCityByTag(e);else if(e==homeKeyword)var t=layout,a=cityController.SpawnCity(e,t,1);else{var t=dataController.GetAllWithTag(e);if(!t||!t.length)return void 0;var a=cityController.SpawnCity(e,t)}if(t&&(t.length||Object.keys(t).length)||o){cityController.SetCity(a);var n=setInterval(function(){finishedLoadingTextures&&(cameraController.CenterOnCity(a),$("#loadinglogo").velocity({opacity:0},{duration:800,complete:function(){clearInterval(n),$("#loadinglogo").css("display","none"),$("#loading").velocity({opacity:"0"},{duration:1200,complete:function(){$("#loading").css("display","none")}})}}))},500);return a}return void 0}var canvasDiv=$("#canvas"),canvas=canvasDiv.get(0),camera=new THREE.PerspectiveCamera(camFOVStart,canvasDiv.width()/canvasDiv.height(),1,300),scene=new THREE.Scene,mouse=new THREE.Vector2,intersected,raycaster=new THREE.Raycaster,renderer=new THREE.WebGLRenderer({antialias:!0}),spotLight=new THREE.SpotLight(16777215),hemilight=null,lightintensity=40,composer,hblurPass,vblurPass,initInterval,objects=[],objs=new _objects,dataController=new objs.dataController,cityController=new objs.cityController(dataController),cameraController=null,fuse,controlsinit=!1,plane,finishedLoadingTextures=!1,textureNames={},loadedTextures=0,loopCount=0;spinfunction(),setInterval(spinfunction,1600),renderer.shadowMapEnabled=!0,$(window).on("resize",resize),document.addEventListener("orientationchange",resize);var cloud2;